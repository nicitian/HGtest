<!DOCTYPE html>
<html lang="en">
    <head>
        <title>淘宝客管理</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="css/bootstrap.min.css" />
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css" />
        <link rel="stylesheet" href="css/datepicker.css" />
        <link rel="stylesheet" href="css/unicorn.main.css" />
        <link rel="stylesheet" href="css/self-define.css" />
        <link rel="stylesheet" href="css/unicorn.red.css" class="skin-color" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>

    <body>
        <div id="header">
			<h1><a href="./index.html">首页</a></h1>
		</div>

		<div id="search">
			<input type="text" placeholder="搜索..." /><button type="submit" class="tip-right" title="Search"><i class="icon-search icon-white"></i></button>
		</div>
		<div id="user-nav" class="navbar navbar-inverse">
			<ul class="nav btn-group">
				<li class="btn btn-inverse"><a title="" href="#"><i class="icon icon-user"></i> <span class="text">用户</span></a></li>
				<li class="btn btn-inverse"><a title="" href="#"><i class="icon icon-cog"></i> <span class="text">设置</span></a></li>
				<li class="btn btn-inverse"><a title="" href="login.html"><i class="icon icon-share-alt"></i> <span class="text">退出</span></a></li>
			</ul>
		</div>

		<div id="sidebar">
			<a href="#" class="visible-phone"><i class="icon icon-home"></i> 首页</a>
			<ul>
				<li ><a href="index.html"><i class="icon icon-home"></i> <span>首页</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-pencil"></i> <span>资金管理</span> <span class="label">4</span></a>
					<ul>
						<li><a href="acc_manage.html">账户管理</a></li>
						<li><a href="rebate_manage.html">返款管理</a></li>
						<li><a href="fund_detail.html">资金明细</a></li>
						<li><a href="recharge_manage.html">充值管理</a></li>
					</ul>
				</li>
				<li><a href="user_info.html"><i class="icon icon-user"></i> <span>用户审核</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-file"></i> <span>账号审核</span> <span class="label">5</span></a>
					<ul>
						<li><a href="user_level.html">用户等级</a></li>
						<li><a href="identity_info.html">身份信息</a></li>
						<li><a href="credit_card.html">银行卡信息</a></li>
						<li><a href="taobao_acc.html">淘宝账号</a></li>
						<li><a href="store_info.html">店铺信息</a></li>
					</ul>
				</li>
				<li class="submenu">
					<a href="#"><i class="icon icon-tasks"></i> <span>任务中心</span> <span class="label">3</span></a>
					<ul>
						<li><a href="task_manage.html">任务管理</a></li>
						<li><a href="order_manage.html">订单管理</a></li>
						<li><a href="problem_orders.html">问题订单</a></li>
					</ul>
				</li>
				<li><a href="notice_manage.html"><i class="icon icon-bullhorn"></i> <span>公告管理</span></a></li>
				<li><a href="appeal_center.html"><i class="icon icon-comment"></i> <span>申述中心</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-wrench"></i> <span>平台账号</span> <span class="label">2</span></a>
					<ul>
						<li><a href="pl_acc_manage.html">账号管理</a></li>
						<li><a href="authority_manage.html">权限管理</a></li>
					</ul>
				</li>
                <li class="submenu open active">
                    <a href="#"><i class="icon icon-book"></i> <span>其他</span> <span class="label">2</span></a>
                    <ul>
                        <li><a href="tk_manage.html">淘宝客管理</a></li>
                        <li class="active"><a href="tk_ad_manage.html">淘宝客广告管理</a></li>
                    </ul>
                </li>
			</ul>
		</div>
        <div id="content">
            <div id="content-header">
				<h1>首页</h1>
			</div>
			<div id="breadcrumb">
				<a href="index.html" title="返回首页" class="tip-bottom"><i class="icon-home"></i> 首页</a>
				<a href="#" class="tip-bottom">淘宝客管理</a>
			</div>
            <div class="container-fluid">
				<div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon"><i class="icon-file"></i></span>
								<h5>淘宝客管理</h5>
							</div>
                            <div class="widget-content nopadding">
								<form class="form-inline">
									<div class="control-group">
										<div class="controls control-s-p">
											<label class="control-label label-s-p">商品标题</label>
                                            <input type="text" class="input-small" id="ipt_title">
                                            <!--
                                            <label class="control-label label-s-p">从</label>
											<input type="text" data-date="2015-01-01" data-date-format="yyyy-mm-dd" class="datepicker input-small" id="start_time"/>
											<label class="control-label">至</label>
											<input type="text" data-date="2015-01-01" data-date-format="yyyy-mm-dd" class="datepicker input-small" id="end_time"/>
											-->
                                            <input type="botton" class="btn btn-primary f-ml-20" style="width:30px" onclick="search_tkgoods()" value="搜索"/>
                                            <a onclick="tk_add()" class="btn btn-primary">新增</a>
                                        </div>
                                    </div>
                                </form>
                                <table class="table s-table-bordered" id="tkgoods_table">
									<thead>
										<tr>
											<th>商品标题</th>
											<th>商品优惠券</th>
                                            <th>商品价格</th>
                                            <th>商品主图</th>
                                            <th>商品链接</th>
                                            <th>是否天猫</th>
											<th>优惠券金额</th>
											<th>优惠券结束时间</th>
											<!--
											<th>销量</th>
                                            <th>优惠券剩余数量</th>
                                            <th>优惠券已领数量</th>
                                            -->
											<th></th>
										</tr>
									</thead>
									<tbody>
										<tr style="display:none">
											<td id="title"></td>
											<td id="quan_goods_link"></td>
                                            <td id="price"></td>
											<td id="pic"></td>
                                            <td id="link"></td>
											<td id="is_tmall"></td>
											<td id="quan_price"></td>
											<td id="quan_time"></td>
                                            <!--
                                            <td id="sales_num"></td>
											<td id="quan_surplus"></td>
											<td id="quan_receive"></td>
											-->
                                            <td id="del"></td>
										</tr>
									</tbody>
								</table>
                                <div id="id_page_count" class="pagination alternate" style="width: 800px;margin: 20px auto;">

								</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
					<div id="footer" class="span12">
						2015 &copy; 版权所有 杭州手赚科技有限公司 <a href="http://www.shouzhuanvip.com/">(ShouZhuan)</a>
					</div>
				</div>
            </div>
        </div>


        <script src="js/jquery.min.js"></script>
		<script src="js/jquery.ui.custom.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootstrap-colorpicker.js"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/jquery.uniform.js"></script>
		<script src="js/select2.min.js"></script>
		<script src="js/unicorn.js"></script>
		<script src="js/unicorn.form_common.js"></script>
        <script src="js/layer/layer.js"></script>
		<script src="js/wangEditor-1.3.5.min.js"></script>
        <script type="text/javascript">
			var step_size	= 10;	//步长
			var current_page	= 1;	//当前页
			var total_page;	//总页数
			var current_url	= "";	//当前url
			var page_step	=9;	//显示页码数
			var left_page;
			var rigth_page;
			Date.prototype.format = function(format){
				var o = {
					"M+" : this.getMonth()+1, //month
					"d+" : this.getDate(), //day
					"h+" : this.getHours(), //hour
					"m+" : this.getMinutes(), //minute
					"s+" : this.getSeconds(), //second
					"q+" : Math.floor((this.getMonth()+3)/3), //quarter
					"S" : this.getMilliseconds() //millisecond
				};

				if(/(y+)/.test(format)) {
					format = format.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
				}

				for(var k in o) {
					if(new RegExp("("+ k +")").test(format)) {
						format = format.replace(RegExp.$1, RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
					}
				}
				return format;
			};

            $(document).ready(function(){
				init_page();
			});

            function init_page(){
                if(current_url == ""){
					current_url	="/rest_web/others/tkgoods/manager?start=0&num="+step_size;
				}
                get_tkgoods_list(current_url);
            }

            // 删除商品
            function del_tkgoods(id){
                $.ajax({
					type: "post",
					dataType: "json",
					url: "/rest_web/others/tkgoods/delete?id="+id,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						if(msg.code==0){
							go_page(current_page);
						}
					}
				});
            }

            function search_tkgoods(){
                current_url	="/rest_web/others/tkgoods/manager?start=0&num="+step_size;
                if($("#ipt_title").val() != ""){
                    current_url += "&title=" + $("#ipt_title").val();
                }
                get_tkgoods_list(current_url);
            }

            function get_tkgoods_list(current_url){
                var tb_row = '<tr style="display:none">'+
                                    '<td id="title"></td>'+
                                    '<td id="quan_goods_link"></td>'+
                                    '<td id="price"></td>'+
                                    '<td id="pic"></td>'+
                                    '<td id="link"></td>'+
                                    '<td id="is_tmall"></td>'+
                                    '<td id="quan_price"></td>'+
                                    '<td id="quan_time"></td>'+
                                    '<td id="del"></td>'+
                                '</tr>';
                $("#tkgoods_table tbody").empty();
                $.ajax({
                    type: "post",
					dataType: "json",
					url: current_url,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
                        //计算页面
						total_page	= parseInt((msg.data.total + (step_size - 1))/step_size);
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= 1;
						if(total_page >= page_step){
							right_page	= left_page + (page_step - 1);
						}else{
							right_page	= total_page;
						}
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
						document.getElementById("id_page_1").className="active";

                        //获取数据
						var data = msg.data.tkgoods;
                        $.each(data, function(i, n){
                            var row = $(tb_row);
                            row.find("#title").html('<a onclick="tk_edit('+ n.id+')" href="javascript:;">'+ n.title+'</a>');
                            row.find("#quan_goods_link").html('<a href="'+ n.quan_goods_link+'" target="_blank">'+ n.quan_goods_link+'</a>');
                            row.find("#price").text(n.price);
                            row.find("#pic").html('<img width="80" height="80" src="'+ n.pic+'" alt="">');
                            row.find("#link").html('<a href="'+ n.link+'" target="_blank">'+ n.link+'</a>');
                            row.find("#is_tmall").text(n.is_tmall == 1?"是":"否");
                            row.find("#quan_price").text(n.quan_price);
                            row.find("#quan_time").text(n.quan_time);

                            row.find("#del").html('<button class="btn btn-danger btn-mini" style="width: 38px; height: 24px;" onclick="del_tkgoods('+n.id+')">删除</button>');
                            row.appendTo("#tkgoods_table");
							row.show();
                        });
                    }
                });
            }

            function go_page(a){
                a	= parseInt(a);

				if(a < 1){
					return false;
				}
				else if(a > total_page){
					return false;
				}

				//document.getElementById("id_page_"+current_page).className="";
				$("#id_page_count ul li").removeClass();
				//重新生成页码
				if(total_page > page_step){
					if(a == 1){//左边界页时
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= 1;
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a == total_page){//右边界页时
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-(page_step-1));
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a <= left_page)
					{
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-1);
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a >= right_page)
					{
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-(page_step-2));
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
				}

				document.getElementById("id_page_"+a).className="active";
				current_page	= a;
                //设置当前url
                current_url="/rest_web/others/tkgoods/manager?";
                current_url	+= "start="+((a-1)*step_size)+"&num="+step_size;
                if($("#ipt_title").val() != ""){
                    current_url += "&title=" + $("#ipt_title").val();
                }
                var tb_row = '<tr style="display:none">'+
                                    '<td id="title"></td>'+
                                    '<td id="quan_goods_link"></td>'+
                                    '<td id="price"></td>'+
                                    '<td id="pic"></td>'+
                                    '<td id="link"></td>'+
                                    '<td id="is_tmall"></td>'+
                                    '<td id="quan_price"></td>'+
                                    '<td id="quan_time"></td>'+
                                    '<td id="del"></td>'+
                                '</tr>';
                $("#tkgoods_table tbody").empty();
                $.ajax({
                    type: "post",
					dataType: "json",
					url: current_url,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
                        //获取数据
						var data = msg.data.tkgoods;
                        $.each(data, function(i, n){
                            var row = $(tb_row);
                            row.find("#title").html('<a onclick="tk_edit('+ n.id+')" href="javascript:;">'+ n.title+'</a>');
                            row.find("#quan_goods_link").html('<a href="'+ n.quan_goods_link+'" target="_blank">'+ n.quan_goods_link+'</a>');
                            row.find("#price").text(n.price);
                            row.find("#pic").html('<img width="80" height="80" src="'+ n.pic+'" alt="">');
                            row.find("#link").html('<a href="'+ n.link+'" target="_blank">'+ n.link+'</a>');
                            row.find("#is_tmall").text(n.is_tmall == 1?"是":"否");
                            row.find("#quan_price").text(n.quan_price);
                            row.find("#quan_time").text(n.quan_time);

                            row.find("#del").html('<button class="btn btn-danger btn-mini" style="width: 38px; height: 24px;" onclick="del_tkgoods('+n.id+')">删除</button>');
                            row.appendTo("#tkgoods_table");
							row.show();
                        });
                    }
                });
            }
            function go2page(){
				go_page(document.getElementById('ipt_page_num').value);
			}

            function tk_add(){
                var this_url = '/others/tk_edit?id=';
                addframe = layer.open({
                    type: 2,
                    title: '添加或修改商品',
                    shadeClose: true,
                    shade: 0.8,
                    area: ['700px', '720px'],
                    content: this_url //iframe的url
                });
            }
            function tk_edit(id){
                var this_url = '/others/tk_edit?id=' + id;
                addframe = layer.open({
                    type: 2,
                    title: '添加或修改商品',
                    shadeClose: true,
                    shade: 0.8,
                    area: ['700px', '720px'],
                    content: this_url //iframe的url
                });
            }
            function close_frame () {
                layer.close(addframe);
                document.location.reload();
            }
        </script>
    </body>
</html>
