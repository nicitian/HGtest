<!DOCTYPE html>
<html lang="zh">
	<head>
		<title>申诉中心</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="css/bootstrap-responsive.min.css" />	
		<link rel="stylesheet" href="css/jquery.gritter.css" />
		<link rel="stylesheet" href="css/datepicker.css" />
		<link rel="stylesheet" href="css/uniform.css" />
		<link rel="stylesheet" href="css/select2.css" />
		<link rel="stylesheet" href="css/unicorn.main.css" />
		<link rel="stylesheet" href="css/self-define.css" />
		<link rel="stylesheet" href="css/unicorn.red.css" class="skin-color" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
	<body>
		
		
		<div id="header">
			<h1><a href="./index.html">申诉中心</a></h1>		
		</div>
		
		<div id="search">
			<input type="text" placeholder="搜索..." /><button type="submit" class="tip-right" title="Search"><i class="icon-search icon-white"></i></button>
		</div>
		<div id="user-nav" class="navbar navbar-inverse">
			<ul class="nav btn-group">
				<li class="btn btn-inverse"><a title="" href="#"><i class="icon icon-user"></i> <span class="text">用户</span></a></li>
				<li class="btn btn-inverse"><a title="" href="#"><i class="icon icon-cog"></i> <span class="text">设置</span></a></li>
				<li class="btn btn-inverse"><a title="" href="login.html"><i class="icon icon-share-alt"></i> <span class="text">退出</span></a></li>
			</ul>
		</div>
						
		<div id="sidebar">
			<a href="#" class="visible-phone"><i class="icon icon-home"></i> 首页</a>
			<ul>
				<li><a href="index.html"><i class="icon icon-home"></i> <span>首页</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-pencil"></i> <span>资金管理</span> <span class="label">4</span></a>
					<ul>
						<li><a href="acc_manage.html">账户管理</a></li>
						<li><a href="rebate_manage.html">返款管理</a></li>
						<li><a href="fund_detail.html">资金明细</a></li>
						<li><a href="recharge_manage.html">充值管理</a></li>
					</ul>
				</li>
				<li><a href="user_info.html"><i class="icon icon-user"></i> <span>用户审核</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-file"></i> <span>账号审核</span> <span class="label">5</span></a>
					<ul>
						<li><a href="user_level.html">用户等级</a></li>
						<li><a href="identity_info.html">身份信息</a></li>
						<li><a href="credit_card.html">银行卡信息</a></li>
						<li><a href="taobao_acc.html">淘宝账号</a></li>
						<li><a href="store_info.html">店铺信息</a></li>
					</ul>
				</li>
				<li class="submenu">
					<a href="#"><i class="icon icon-tasks"></i> <span>任务中心</span> <span class="label">3</span></a>
					<ul>
						<li><a href="task_manage.html">任务管理</a></li>
						<li><a href="order_manage.html">订单管理</a></li>
						<li><a href="problem_orders.html">问题订单</a></li>
					</ul>
				</li>
				<li><a href="notice_manage.html"><i class="icon icon-bullhorn"></i> <span>公告管理</span></a></li>
				<li class="active"><a href="appeal_center.html"><i class="icon icon-comment"></i> <span>申述中心</span></a></li>
				<li class="submenu">
					<a href="#"><i class="icon icon-wrench"></i> <span>平台账号</span> <span class="label">2</span></a>
					<ul>
						<li><a href="pl_acc_manage.html">账号管理</a></li>
						<li><a href="authority_manage.html">权限管理</a></li>
					</ul>
				</li>
                 <li class="submenu">
                    <a href="#"><i class="icon icon-book"></i> <span>其他</span> <span class="label">2</span></a>
                    <ul>
                        <li><a href="tk_manage.html">淘宝客管理</a></li>
                        <li><a href="tk_ad_manage.html">淘宝客广告管理</a></li>
                    </ul>
                </li>
			</ul>
		</div>
		
		<div id="style-switcher">
			<i class="icon-arrow-left icon-white"></i>
			<span>Style:</span>
			<a href="#grey" style="background-color: #555555;border-color: #aaaaaa;"></a>
			<a href="#blue" style="background-color: #2D2F57;"></a>
			<a href="#red" style="background-color: #673232;"></a>
		</div>
		
		<div id="content">
			<div id="content-header">
				<h1>申诉中心</h1>
			</div>
			<div id="breadcrumb">
				<a href="index.html" title="返回首页" class="tip-bottom"><i class="icon-home"></i> 首页</a>
				<a href="#" class="current">申诉中心</a>
			</div>
			<div class="container-fluid">
				<div class="row-fluid">
					<div class="span12">
						<div class="widget-box">
							<div class="widget-title">
								<span class="icon"><i class="icon-file"></i></span>
								<h5>订单管理</h5>
							</div>
							<div class="widget-content nopadding">
								<form class="form-inline">
									<div class="control-group">
										<div class="controls control-s-p">
											<label class="control-label label-s-p">申诉类型</label>
											<select id="slt_appeal_type">
												<option value='0'/>全部&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='1'/>返款问题&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='2'/>商品错误&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='3'/>快递问题&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='4'/>其他问题&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='6'/>买手做任务问题&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
												<option value='7'/>买手确认收货好评问题&nbsp
											</select>
											<label class="control-label label-s-p">申诉状态</label>
											<select id="slt_appeal_status">
												<option value='0'/>全  部
												<option value='1'/>进行中
												<option value='2'/>已完结
											</select>
											<label class="control-label label-s-p">订单编号</label>
											<input type="text" class="input-small" id="ipt_order_id">
										</div>
										<div class="controls control-s-p">
											<label class="control-label label-s-p">平台介入</label>
											<select id="slt_get_involved">
												<option value='-1'/>无
												<option value='0'/>否
												<option value='1'/>是
											</select>
											<label class="control-label label-s-p">从</label>
											<input type="text" data-date="2015-01-01" data-date-format="yyyy-mm-dd" class="datepicker input-small" id="appeal_start_time"/>
											<label class="control-label">至</label>
											<input type="text" data-date="2015-01-01" data-date-format="yyyy-mm-dd" class="datepicker input-small" id="appeal_end_time"/>
											<input type="botton" class="btn btn-primary f-ml-20" style="width:30px" onclick="search_appeal_info()" value="搜索"/>
										</div>
									</div>
								</form>
								<table class="table s-table-bordered" id="appeal_table">
									<thead>
										<tr>
											<th>时间</th>
											<th>订单编号</th>
											<th>申诉类型</th>
											<th>申诉进度</th>
											<th>图片凭证</th>
											<th>发起方ID</th>
											<th>被发起方ID</th>
											<th>撤单操作</th>
											<th>完结操作</th>
											<th>状态</th>
										</tr>
									</thead>
									<tbody>
										<tr style="display:none">
											<td id="appeal_time"></td>
											<td id="order_id"></td>
											<td id="appeal_type"></td>
											<td id="appeal_proc"></td>
											<td id="pic_evidence"></td>
											<td id="complainant_id"></td>
											<td id="respondent_id"></td>
											<td id="cancel_oper"></td>
											<td id="finish_oper"></td>
											<td id="appeal_status"></td>
										</tr>
									</tbody>
								</table>
								<div id="id_page_count" class="pagination alternate" style="width: 800px;margin: 20px auto;">
									<!--ul>
										<li><a href="#">上一页</a></li>
										<li class="active">
											<a href="#">1</a>
										</li>
										<li><a href="#">2</a></li>
										<li><a href="#">3</a></li>
										<li><a href="#">4</a></li>
										<li><a href="#">5</a></li>
										<li><a href="#">下一页</a></li>
									</ul-->
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-fluid">
					<div id="footer" class="span12">
						2015 &copy; 版权所有 杭州手赚科技有限公司 <a href="http://120.26.214.214/">(ShouZhuan)</a>
					</div>
				</div>
			</div>
		</div>
		
		<div id="id_modal_cont">
			<div id="process_detail" class="modal hide" aria-hidden="true" style="display: none;">
				<div class="modal-header">
					<button data-dismiss="modal" class="close" type="button">×</button>
					<h3>进度详情</h3>
				</div>
				<div class="modal-body">
					<ul class="recent-posts" id="progress_detail">
						<!--li>
							<p style="color: #999999;">2015-09-22 19:17</p>
							<p style="margin-top: -10px;"><span class="label label-success">申诉人</span>：这怎么办啊？</p>
						</li>
						<li>
							<p style="color: #999999;">2015-09-22 19:17</p>
							<p style="margin-top: -10px;"><span class="label label-important">被诉人</span>：这次算了，下次注意！</p>
						</li>
						<li>
							<p style="color: #999999;">2015-09-22 19:17</p>
							<p style="margin-top: -10px;"><span class="label label-warning">平台方</span>：很不错哟！</p>
						</li-->
					</ul>
				</div>
			</div>
			<div id="evidence_pic" class="modal hide" aria-hidden="true" style="display: none;">
				<div class="modal-header">
					<button data-dismiss="modal" class="close" type="button">×</button>
					<h3>图片凭证详情</h3>
				</div>
				<div class="modal-body">
					<ul class="recent-posts" id="evidence_detail">
						<!--li>
							<img width="100%" src="./img/laptop_org.png"/>
						</li>
						<li>
							<img width="100%" src="./img/mobile_org.png"/>
						</li>
						<li>
							<img width="100%" src="./img/laptop_org.png"/>
						</li-->
					</ul>
				</div>
			</div>
		</div>
		
		<div id="fine_model" class="modal hide in" aria-hidden="false" style="display: none;">
			<input type="hidden" id="user_id4fine">
			<div class="modal-header">
				<button data-dismiss="modal" class="close" type="button">×</button>
				<h3>用户罚款</h3>
			</div>
			<div class="modal-body">
				<form class="form-inline">
					<div class="control-group">
						<div class="controls control-s-p">
							<label class="control-label">罚款金额</label>
							<input type="text" style="width: 450px;" id="ipt_fine_am">
						</div>
					</div>
					<div class="control-group">
						<div class="controls control-s-p">
							<label><input type="radio" name="acc_type" checked="true"/>本金账户</label>
							<label><input type="radio" name="acc_type" />佣金账户</label>
						</div>
					</div>
					<div class="control-group">
						<div class="controls control-s-p">
							<label class="control-label">备注说明</label>
							<textarea style="width: 450px;" id="id_fine_remark"></textarea>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<a data-dismiss="modal" class="btn btn-primary" href="#" onclick="confirm_fine()">确定</a>
				<a data-dismiss="modal" class="btn" href="#">取消</a>
			</div>
		</div>
		
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.ui.custom.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/bootstrap-colorpicker.js"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/jquery.uniform.js"></script>
		<script src="js/jquery.gritter.min.js"></script>
		<script src="js/select2.min.js"></script>
		<script src="js/unicorn.js"></script>
		<script src="js/unicorn.form_common.js"></script>
		<script type="text/javascript">
			var step_size	= 10;	//步长
			var current_page	= 1;	//当前页
			var total_page;	//总页数
			var current_url	= "";	//当前url
			var page_step	=9;	//显示页码数
			var left_page;
			var rigth_page;
			Date.prototype.format = function(format){ 
				var o = { 
					"M+" : this.getMonth()+1, //month 
					"d+" : this.getDate(), //day 
					"h+" : this.getHours(), //hour 
					"m+" : this.getMinutes(), //minute 
					"s+" : this.getSeconds(), //second 
					"q+" : Math.floor((this.getMonth()+3)/3), //quarter 
					"S" : this.getMilliseconds() //millisecond 
				}
				
				if(/(y+)/.test(format)) { 
					format = format.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length)); 
				} 
				
				for(var k in o) { 
					if(new RegExp("("+ k +")").test(format)) { 
						format = format.replace(RegExp.$1, RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length)); 
					} 
				} 
				return format; 
			}
			function confirm_fine(){
				var fine_acc_type	= 0;
				if(document.getElementsByName("acc_type")[0].checked){
					fine_acc_type	= 0;
				}else{
					fine_acc_type	= 1;
				}
				var fine_param	= "amount="+document.getElementById("ipt_fine_am").value+"&reason="+document.getElementById("id_fine_remark").value+"&type="+fine_acc_type;
				console.log(fine_param);
				$.ajax({
					type: "post",
					dataType: "json",
					url: "/rest_web/management/finance/add/"+document.getElementById("user_id4fine").value,
					data: fine_param,
					complete :function(){$("#load").hide();},
					success: function(msg){
						if(msg.code==0){
							go_page(current_page);
						}
					}
				});
			}
			function user_fine(id){
				document.getElementById("user_id4fine").value	= id;
			}
			function cancel_order(id){
				$.ajax({
					type: "post",
					dataType: "json",
					url: "/rest_web/tasks/cancel/handle/"+id,
					data: "cancel=true",
					complete :function(){$("#load").hide();},
					success: function(msg){
						if(msg.code==0){
							go_page(current_page);
						}else if(msg.code==-120){
							$.gritter.add({
								title:	'错误,代码-120',
								text:	'本金账户余额不足',
								sticky: false
							});
						}
					}
				});
			}
			function finish_appeal(id){
				$.ajax({
					type: "post",
					dataType: "json",
					url: "/rest_web/tasks/platform/finish/"+id,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						if(msg.code==0){
							go_page(current_page);
						}
					}
				});
			}
			function get_appeal_detail(id,type){
				$.ajax({
					type: "post",
					dataType: "json",
					url: "/rest_web/tasks/appeal/get/"+id,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						if(type == 0){
							var progress	= '';
							var progress_list=eval('('+msg.data.progress+')');
							for(var i=0;i<progress_list.length;i++){
								progress	+= '<li>';
								var progress_time=new Date(progress_list[i].create_time);
								progress	+= '<p style="color: #999999;">'+progress_time.format("yyyy-MM-dd hh:mm:ss")+'</p>';
								
								if(progress_list[i].source == 1){
									progress	+= '<p style="margin-top: -10px;"><span class="label label-success">申诉人</span>：'+progress_list[i].content+'</p>';
								}else if(progress_list[i].source == 2){
									progress	+= '<p style="margin-top: -10px;"><span class="label label-important">被诉人</span>：'+progress_list[i].content+'</p>';
								}else if(progress_list[i].source == 3){
									progress	+= '<p style="margin-top: -10px;"><span class="label label-warning">平台方</span>：'+progress_list[i].content+'</p>';
								}
								progress	+= '</li>';
							}
							document.getElementById('progress_detail').innerHTML=progress;
						}else{
							var evidence	= '';
							var evidence_list=eval('('+msg.data.pic_path+')');
							for(var j=0;j<evidence_list.length;j++){
								evidence	+= '<li>';
								evidence	+= '<img width="100%" src="'+evidence_list[j]+'"/>';
								evidence	+= '</li>';
							}
							document.getElementById('evidence_detail').innerHTML=evidence;
						}
					}
				});
			}
			function go2page(){
				go_page(document.getElementById('ipt_page_num').value);
			}
			function init_page(){
				//设置当前url
				if(current_url == ""){
					current_url	="/rest_web/tasks/appeal/list?start=0&num="+step_size;
				}
				
				var tb_row	='<tr style="display:none"><td id="appeal_time"></td><td id="order_id"></td><td id="appeal_type"></td><td id="appeal_proc"></td><td id="pic_evidence"></td><td id="complainant_id"></td><td id="respondent_id"></td><td id="cancel_oper"></td><td id="finish_oper"></td><td id="appeal_status"></td></tr>';
				$("#appeal_table tbody").empty();
				$.ajax({
					type: "post",
					dataType: "json",
					url: current_url,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						//计算页面
						total_page	= parseInt((msg.data.total + (step_size - 1))/step_size);
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= 1;
						if(total_page >= page_step){
							right_page	= left_page + (page_step - 1);
						}else{
							right_page	= total_page;
						}
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
						document.getElementById("id_page_1").className="active";
						
						//获取数据
						var data = msg.data.appeals;
						$.each(data, function(i, n){
							var row = $(tb_row);
							var appeal_time=new Date(n.create_time);
							row.find("#appeal_time").text(appeal_time.format("yyyy-MM-dd hh:mm:ss"));
							row.find("#order_id").text(n.order_id);
							
							if(n.appealtype_id == 1){
								row.find("#appeal_type").text("返款问题");
							}else if(n.appealtype_id == 2){
								row.find("#appeal_type").text("商品错误");
							}else if(n.appealtype_id == 3){
								row.find("#appeal_type").text("快递问题");
							}else if(n.appealtype_id == 4){
								row.find("#appeal_type").text("其他问题");
							}else if(n.appealtype_id == 6){
								row.find("#appeal_type").text("买手做任务问题");
							}else if(n.appealtype_id == 7){
								row.find("#appeal_type").text("买手确认收货好评问题");
							}
							
							row.find("#appeal_proc").html('<a href="#process_detail" class="tip-bottom" data-toggle="modal" data-original-title="点击查看进度" onclick="get_appeal_detail('+n.id+',0)">进度查看</a>');
							row.find("#pic_evidence").html('<a href="#evidence_pic" class="tip-bottom" data-toggle="modal" data-original-title="点击查看凭证" onclick="get_appeal_detail('+n.id+',1)">凭证查看</a>');
							
							row.find("#complainant_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.complainant_id+')">'+n.complainant_id+'</a>');
							row.find("#respondent_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.respondent_id+')">'+n.respondent_id+'</a>');
							
							if(n.forced){
								row.find("#cancel_oper").html('<button class="btn btn-danger btn-mini" style="width: 76px; height: 24px;" onclick="cancel_order('+n.id+')">强制撤单</button>');
							}else{
								row.find("#cancel_oper").html('<span class="label">撤单条件不足</span>');
							}
							row.find("#finish_oper").html('<button class="btn btn-success btn-mini" style="width: 38px; height: 24px;" onclick="finish_appeal('+n.id+')">完结</button>');
							
							if(n.status == 1){
								row.find("#appeal_status").html('<span class="label label-warning">进行中</span>');
							}else{
								row.find("#appeal_status").html('<span class="label label-success">已完结</span>');
							}
							
							row.appendTo("#appeal_table");
							row.show();
						});
					}
				});
			}
			function get_appeal_list(){
				
				current_url	= "/rest_web/tasks/appeal/list?";
				if(document.getElementById('slt_appeal_type').value != 0){
					current_url	+= "appealtype_id=" + document.getElementById('slt_appeal_type').value  + "&";
				}
				if(document.getElementById('slt_appeal_status').value != 0){
					current_url	+= "status=" + document.getElementById('slt_appeal_status').value  + "&";
				}
				if(document.getElementById('ipt_order_id').value != ""){
					current_url	+= "order_id=" + document.getElementById('ipt_order_id').value + "&";
				}
				if(document.getElementById('slt_get_involved').value != -1){
					current_url	+= "platform_involve=" + document.getElementById('slt_get_involved').value  + "&";
				}
				if(document.getElementById('appeal_start_time').value != "" && document.getElementById('appeal_end_time').value != ""){
					current_url	+= "start_date=" + document.getElementById('appeal_start_time').value  + "&end_date=" + document.getElementById('appeal_end_time').value + "&";
				}
				current_url	+= "start=0&num="+step_size;
				
				var tb_row	='<tr style="display:none"><td id="appeal_time"></td><td id="order_id"></td><td id="appeal_type"></td><td id="appeal_proc"></td><td id="pic_evidence"></td><td id="complainant_id"></td><td id="respondent_id"></td><td id="cancel_oper"></td><td id="finish_oper"></td><td id="appeal_status"></td></tr>';
				$("#appeal_table tbody").empty();
				$.ajax({
					type: "post",
					dataType: "json",
					url: current_url,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						//计算页面
						current_page	= 1;	//重置当前页
						total_page	= parseInt((msg.data.total + (step_size - 1))/step_size);
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= 1;
						if(total_page >= page_step){
							right_page	= left_page + (page_step - 1);
						}else{
							right_page	= total_page;
						}
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
						document.getElementById("id_page_1").className="active";
						
						//获取数据
						var data = msg.data.appeals;
						$.each(data, function(i, n){
							var row = $(tb_row);
							var appeal_time=new Date(n.create_time);
							row.find("#appeal_time").text(appeal_time.format("yyyy-MM-dd hh:mm:ss"));
							row.find("#order_id").text(n.order_id);
							
							if(n.appealtype_id == 1){
								row.find("#appeal_type").text("返款问题");
							}else if(n.appealtype_id == 2){
								row.find("#appeal_type").text("商品错误");
							}else if(n.appealtype_id == 3){
								row.find("#appeal_type").text("快递问题");
							}else if(n.appealtype_id == 4){
								row.find("#appeal_type").text("其他问题");
							}else if(n.appealtype_id == 6){
								row.find("#appeal_type").text("买手做任务问题");
							}else if(n.appealtype_id == 7){
								row.find("#appeal_type").text("买手确认收货好评问题");
							}
							
							row.find("#appeal_proc").html('<a href="#process_detail" class="tip-bottom" data-toggle="modal" data-original-title="点击查看进度" onclick="get_appeal_detail('+n.id+',0)">进度查看</a>');
							row.find("#pic_evidence").html('<a href="#evidence_pic" class="tip-bottom" data-toggle="modal" data-original-title="点击查看凭证" onclick="get_appeal_detail('+n.id+',1)">凭证查看</a>');
							
							row.find("#complainant_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.complainant_id+')">'+n.complainant_id+'</a>');
							row.find("#respondent_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.respondent_id+')">'+n.respondent_id+'</a>');
							
							if(n.forced){
								row.find("#cancel_oper").html('<button class="btn btn-danger btn-mini" style="width: 76px; height: 24px;" onclick="cancel_order('+n.id+')">强制撤单</button>');
							}else{
								row.find("#cancel_oper").html('<span class="label">撤单条件不足</span>');
							}
							row.find("#finish_oper").html('<button class="btn btn-success btn-mini" style="width: 38px; height: 24px;" onclick="finish_appeal('+n.id+')">完结</button>');
							
							if(n.status == 1){
								row.find("#appeal_status").html('<span class="label label-warning">进行中</span>');
							}else{
								row.find("#appeal_status").html('<span class="label label-success">已完结</span>');
							}
							
							row.appendTo("#appeal_table");
							row.show();
						});
					}
				});
			}
			function go_page(a){
				a	= parseInt(a);
				
				if(a < 1){
					return false;
				}
				else if(a > total_page){
					return false;
				}
				
				//document.getElementById("id_page_"+current_page).className="";
				$("#id_page_count ul li").removeClass();
				//重新生成页码
				if(total_page > page_step){
					if(a == 1){//左边界页时
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= 1;
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a == total_page){//右边界页时
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-(page_step-1));
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a <= left_page)
					{
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-1);
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
					else if(a >= right_page)
					{
						$("#id_page_count").empty();
						var page_count	= "<ul><li><a>共"+total_page+"页</a></li><li><a onclick='go_page(current_page-1)'>上一页</a></li>";
						left_page	= (a-(page_step-2));
						right_page	= left_page + (page_step - 1);
						for(i=left_page;i<=right_page;i++){
							page_count	+= "<li id='id_page_"+i+"'><a onclick='go_page("+i+")'>"+i+"</a></li>";
						}
						page_count	+= "<li><a onclick='go_page(current_page+1)'>下一页</a></li><li>转到<input type='text' id='ipt_page_num' style='width: 50px;height: 16px;'/>页<button class='btn btn-mini' onclick='go2page()' style='height: 26px;margin-top: -10px;'>确定</button></li></ul>";
						document.getElementById('id_page_count').innerHTML=page_count;
					}
				}
				
				document.getElementById("id_page_"+a).className="active";
				current_page	= a;
				
				//设置当前url
				current_url	= "/rest_web/tasks/appeal/list?";
				if(document.getElementById('slt_appeal_type').value != 0){
					current_url	+= "appealtype_id=" + document.getElementById('slt_appeal_type').value  + "&";
				}
				if(document.getElementById('slt_appeal_status').value != 0){
					current_url	+= "status=" + document.getElementById('slt_appeal_status').value  + "&";
				}
				if(document.getElementById('ipt_order_id').value != ""){
					current_url	+= "order_id=" + document.getElementById('ipt_order_id').value + "&";
				}
				if(document.getElementById('slt_get_involved').value != -1){
					current_url	+= "platform_involve=" + document.getElementById('slt_get_involved').value  + "&";
				}
				if(document.getElementById('appeal_start_time').value != "" && document.getElementById('appeal_end_time').value != ""){
					current_url	+= "start_date=" + document.getElementById('appeal_start_time').value  + "&end_date=" + document.getElementById('appeal_end_time').value + "&";
				}
				current_url	+= "start="+((a-1)*step_size)+"&num="+step_size;
				
				var tb_row	='<tr style="display:none"><td id="appeal_time"></td><td id="order_id"></td><td id="appeal_type"></td><td id="appeal_proc"></td><td id="pic_evidence"></td><td id="complainant_id"></td><td id="respondent_id"></td><td id="cancel_oper"></td><td id="finish_oper"></td><td id="appeal_status"></td></tr>';
				$("#appeal_table tbody").empty();
				$.ajax({
					type: "post",
					dataType: "json",
					url: current_url,
					data: "",
					complete :function(){$("#load").hide();},
					success: function(msg){
						var data = msg.data.appeals;
						$.each(data, function(i, n){
							var row = $(tb_row);
							var appeal_time=new Date(n.create_time);
							row.find("#appeal_time").text(appeal_time.format("yyyy-MM-dd hh:mm:ss"));
							row.find("#order_id").text(n.order_id);
							
							if(n.appealtype_id == 1){
								row.find("#appeal_type").text("返款问题");
							}else if(n.appealtype_id == 2){
								row.find("#appeal_type").text("商品错误");
							}else if(n.appealtype_id == 3){
								row.find("#appeal_type").text("快递问题");
							}else if(n.appealtype_id == 4){
								row.find("#appeal_type").text("其他问题");
							}else if(n.appealtype_id == 6){
								row.find("#appeal_type").text("买手做任务问题");
							}else if(n.appealtype_id == 7){
								row.find("#appeal_type").text("买手确认收货好评问题");
							}
							
							row.find("#appeal_proc").html('<a href="#process_detail" class="tip-bottom" data-toggle="modal" data-original-title="点击查看进度" onclick="get_appeal_detail('+n.id+',0)">进度查看</a>');
							row.find("#pic_evidence").html('<a href="#evidence_pic" class="tip-bottom" data-toggle="modal" data-original-title="点击查看凭证" onclick="get_appeal_detail('+n.id+',1)">凭证查看</a>');
							
							row.find("#complainant_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.complainant_id+')">'+n.complainant_id+'</a>');
							row.find("#respondent_id").html('<a href="#fine_model" data-toggle="modal" class="tip-bottom" onclick="user_fine('+n.respondent_id+')">'+n.respondent_id+'</a>');
							
							if(n.forced){
								row.find("#cancel_oper").html('<button class="btn btn-danger btn-mini" style="width: 76px; height: 24px;" onclick="cancel_order('+n.id+')">强制撤单</button>');
							}else{
								row.find("#cancel_oper").html('<span class="label">撤单条件不足</span>');
							}
							row.find("#finish_oper").html('<button class="btn btn-success btn-mini" style="width: 38px; height: 24px;" onclick="finish_appeal('+n.id+')">完结</button>');
							
							if(n.status == 1){
								row.find("#appeal_status").html('<span class="label label-warning">进行中</span>');
							}else{
								row.find("#appeal_status").html('<span class="label label-success">已完结</span>');
							}
							
							row.appendTo("#appeal_table");
							row.show();
						});
					}
				});
			}
			function search_appeal_info(){
				get_appeal_list();
				return false;
			}
			$(document).ready(function(){
				init_page();
			});
		</script>
	</body>
</html>
